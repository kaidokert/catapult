{
  "comments": [
    {
      "key": {
        "uuid": "88683014_bd8a004b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1327821
      },
      "writtenOn": "2020-05-13T04:49:25Z",
      "side": 1,
      "message": "Do we have an existing issue we can use to track this against? I\u0027m fairly certain that this could be associated with the issue regarding the readability of the filed messages.",
      "revId": "c7962c13ea36041b54d7a619786916cdcf41a819",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4115d316_17233f14",
        "filename": "/COMMIT_MSG",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1284623
      },
      "writtenOn": "2020-05-13T04:59:39Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "88683014_bd8a004b",
      "revId": "c7962c13ea36041b54d7a619786916cdcf41a819",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e1f5ecb9_2fee5b0e",
        "filename": "dashboard/dashboard/pinpoint/models/job_bug_update.py",
        "patchSetId": 6
      },
      "lineNbr": 175,
      "author": {
        "id": 1327821
      },
      "writtenOn": "2020-05-13T04:49:25Z",
      "side": 1,
      "message": "Similar comment in other places, this is quite expensive. Consider moving this to global scope and having it initialised once.",
      "range": {
        "startLine": 175,
        "startChar": 2,
        "endLine": 175,
        "endChar": 59
      },
      "revId": "c7962c13ea36041b54d7a619786916cdcf41a819",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2bd4a499_c524543b",
        "filename": "dashboard/dashboard/pinpoint/models/job_bug_update.py",
        "patchSetId": 6
      },
      "lineNbr": 175,
      "author": {
        "id": 1284623
      },
      "writtenOn": "2020-05-13T04:59:39Z",
      "side": 1,
      "message": "https://jinja.palletsprojects.com/en/2.11.x/api/#jinja2.Environment says jinja2.Environment has a default `cache_size` of 400 (or 50 for earlier versions, which might apply to us).  Either way, 1 template is much lower than 400 (or 50) templates.  Manually caching templates seems to be fighting against jinja\u0027s builtin facilities rather than working with them.\n\nIt seems reasonable to add a get_template call at module load time to warm the cache before any request handling occurs, though.  WDYT?",
      "parentUuid": "e1f5ecb9_2fee5b0e",
      "range": {
        "startLine": 175,
        "startChar": 2,
        "endLine": 175,
        "endChar": 59
      },
      "revId": "c7962c13ea36041b54d7a619786916cdcf41a819",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c70ebe4d_2182ee5d",
        "filename": "dashboard/dashboard/pinpoint/models/job_bug_update.py",
        "patchSetId": 6
      },
      "lineNbr": 175,
      "author": {
        "id": 1327821
      },
      "writtenOn": "2020-05-13T05:14:46Z",
      "side": 1,
      "message": "We already do that with the auto-triage bits -- we ensure that the template is cached, and that we\u0027re not using the \u0027get_template\u0027 call lookup in the deep parts of the code. This is because the way App Engine works is it will re-use instances, so module-level variables only get initialised once.\n\nAvoiding the lookup is what I\u0027m concerned with, not that we\u0027re using the cache.",
      "parentUuid": "2bd4a499_c524543b",
      "range": {
        "startLine": 175,
        "startChar": 2,
        "endLine": 175,
        "endChar": 59
      },
      "revId": "c7962c13ea36041b54d7a619786916cdcf41a819",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d06a3f25_1cfc69ea",
        "filename": "dashboard/dashboard/pinpoint/models/job_bug_update.py",
        "patchSetId": 6
      },
      "lineNbr": 175,
      "author": {
        "id": 1284623
      },
      "writtenOn": "2020-05-14T05:27:40Z",
      "side": 1,
      "message": "Done to unblock this, but I don\u0027t understand your concern here.  Which lookup are you concerned with?\n\nEnviroment.get_template will (after the first load) always get the template directly out of the Environment\u0027s cache here.  I suppose there might be a stat call to check the filesystem hasn\u0027t changed, but if that\u0027s the concern we can just set auto_reload\u003dFalse on the Environment to disable that check.  I just don\u0027t understand why a get_template call would be at all expensive compared to the cost of the render call.  I also don\u0027t understand the comment about module-level variables â€” this environment object is already a module-level global, so adding a module-level template isn\u0027t fundamentally changing any object lifetimes here.\n\nAlso we don\u0027t do anything to avoid the get_template call in dashboard/dashboard/common/request_handler.py:44, which is in a more latency sensitive code path.",
      "parentUuid": "c70ebe4d_2182ee5d",
      "range": {
        "startLine": 175,
        "startChar": 2,
        "endLine": 175,
        "endChar": 59
      },
      "revId": "c7962c13ea36041b54d7a619786916cdcf41a819",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ba221ffe_cb1ada19",
        "filename": "dashboard/dashboard/pinpoint/models/templates/differences_found.j2",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1327821
      },
      "writtenOn": "2020-05-13T04:49:25Z",
      "side": 1,
      "message": "I\u0027m fairly excited about this change, and I\u0027m looking forward to the richer details we can be providing!",
      "revId": "c7962c13ea36041b54d7a619786916cdcf41a819",
      "serverId": "3ce6091f-6c88-37e8-8c75-72f92ae8dfba",
      "unresolved": false
    }
  ]
}